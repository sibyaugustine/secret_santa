/*@license
 * ScratchCard
 *
 * Copyright Masth0
 * Released under the MIT license.
 * https://masth0.github.io/ScratchCard/
 *
 */
var Scratch=function(){function t(t,e){var i={};for(var n in t)i[n]=t[n];for(var n in e)i[n]=e[n];return i}var e=function(e){this.cursor={png:"",cur:"",x:0,y:0,default:"auto"},this.pointSize={x:5,y:5},this.defaults={canvasId:"",imageBackground:"",pictureOver:"",cursor:this.cursor,canvasWidth:250,canvasHeight:250,radius:40,nPoints:10,pointSize:this.pointSize,percent:null,callback:null},this.options=t(this.defaults,e),this.options.cursor=t(this.cursor,e.cursor),this.options.pointSize=t(this.pointSize,e.pointSize),this.init()};return e.prototype.init=function(){var t=this;this.canvas=document.getElementById(this.options.canvasId),this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.options.canvasWidth,this.canvas.height=this.options.canvasHeight,this.image=new Image,this.image.src=this.options.pictureOver,this.percent=0,this.zone=null,this.pixelRatio=window.devicePixelRatio,this.setBackground(),this.setCursor();var e=function(e){e.preventDefault(),t.scratch(e);var i=t.readyToClear();i&&(t.clear(),t.canvas.style.pointerEvents="none",t.callback(t.options.callback))};window.addEventListener("resize",function(){t.update(),t.redraw()}),window.addEventListener("scroll",function(){t.update()}),this.canvas.addEventListener("mousedown",function(i){t.canvas.addEventListener("mousemove",e),document.body.addEventListener("mouseup",function i(){t.canvas.removeEventListener("mousemove",e),this.removeEventListener("mouseup",i)})}),this.canvas.addEventListener("touchstart",function(i){t.canvas.addEventListener("touchmove",e),document.body.addEventListener("touchend",function i(){t.canvas.removeEventListener("touchmove",e),this.removeEventListener("touchend",i)})})},e.prototype.setCursor=function(){var t="";t+=document.documentElement.classList.contains("is-ie")||navigator.userAgent.indexOf("Trident")!=-1||navigator.userAgent.indexOf("Edge")!=-1?"url("+this.options.cursor.cur+"), auto":"url("+this.options.cursor.png+") "+this.options.cursor.x+" "+this.options.cursor.y+", pointer",this.canvas.setAttribute("style","cursor:"+t+";")},e.prototype.update=function(){this.zone=this.canvas.getBoundingClientRect()},e.prototype.redraw=function(){var t=this.options.canvasWidth,e=this.zone.width;e<t&&(this.ctx.clearRect(0,0,this.zone.width,this.zone.height),this.canvas.width=this.zone.width,this.canvas.height=this.zone.height,this.ctx.drawImage(this.image,0,0,this.zone.width,this.zone.height))},e.prototype.setBackground=function(){var t=this;this.image.onload=function(){t.zone=t.canvas.getBoundingClientRect(),t.ctx.drawImage(this,0,0);var e=document.createElement("img");e.classList.add("scratch_picture-under"),e.src=t.options.imageBackground,t.canvas.parentElement.insertBefore(e,t.canvas)}},e.prototype.clearPoint=function(t,e){var i=this.options.radius,n=2*Math.random()*i-i,s=Math.sqrt(i*i-n*n),o=2*Math.random()*s-s;return n+=i,o+=i,n=parseInt(n,10),o=parseInt(o,10),{x:n+t,y:o+e}},e.prototype.getPosition=function(t){var e,i;switch(t.type){case"touchmove":e=t.touches[0].clientX-this.options.radius-window.pageXOffset,i=t.touches[0].clientY-this.options.radius-window.pageYOffset;break;case"mousemove":e=t.clientX-this.options.radius-window.pageXOffset,i=t.clientY-this.options.radius-window.pageYOffset}return{x:e,y:i}},e.prototype.scratch=function(t){var e=this.getPosition(t),i=e.x-this.zone.left,n=e.y-this.zone.top+window.pageYOffset,s=0,o=this.options.nPoints;for(s;s<o;s++){var a=this.clearPoint(i,n);this.ctx.clearRect(a.x,a.y,this.options.pointSize.x,this.options.pointSize.y)}this.percent=this.getPercent()},e.prototype.getPercent=function(){for(var t,e=0,i=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),n=i.data.length,s=0;s<n;s+=4)0===i.data[s]&&0===i.data[s+1]&&0===i.data[s+2]&&0===i.data[s+3]&&e++;return t=e>=1?e/(this.canvas.width*this.canvas.height)*100:0},e.prototype.clear=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},e.prototype.readyToClear=function(){return this.percent>=this.options.percent},e.prototype.callback=function(t){null!=t&&this.percent>=this.options.percent&&t()},e}();